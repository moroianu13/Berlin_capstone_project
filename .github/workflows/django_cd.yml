 - name: Deploy to EC2 with Docker Compose
   env:
     DEPLOY_HOST: ${{ secrets.DEPLOY_HOST }}
     DEPLOY_USER: ${{ secrets.DEPLOY_USER }}
     PEM_FILE: ${{ secrets.EC2_PEM_FILE }}
   run: |
    
     printf "%s" "$PEM_FILE" > ec2_key.pem

   
     chmod 600 ec2_key.pem

   
     ssh-keyscan -H $DEPLOY_HOST >> ~/.ssh/known_hosts

   
     ssh -i ec2_key.pem -o IdentitiesOnly=yes $DEPLOY_USER@$DEPLOY_HOST "
       set -e  # Stop on errors
       cd /home/ubuntu/backend &&
       git pull origin main &&
       docker-compose down &&
       docker-compose build &&
       docker-compose up -d
     "

   
     rm -f ec2_key.pem
